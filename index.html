<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>KMCA Live Waitlists — Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100..900&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#002D72;
      --ink:#0b1d39;
      --glass:#ffffff22;
      --stroke:#ffffff33;
      --card:#ffffff;
      --radius:22px;
      --shadow-lg:0 18px 50px rgba(6,26,64,.28);
      --shadow:0 10px 28px rgba(6,26,64,.20);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Noto Kufi Arabic", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 900px at 85% -200px, #1b57b9 0%, transparent 60%),
        radial-gradient(1200px 900px at -10% 100%, #0f2d69 0%, #06183a 70%);
      background-attachment:fixed;
      overflow:hidden;
    }

    /* ---------- Start Screen ---------- */
    #start-screen{
      height:100%;display:flex;align-items:center;justify-content:center;
      color:#fff;cursor:pointer;text-align:center;user-select:none;
      letter-spacing:.4px;font-weight:800;font-size:30px;
      background: linear-gradient(135deg, rgba(0,0,0,.30), rgba(255,255,255,.06));
      backdrop-filter: blur(6px);
    }
    #start-screen:hover{ filter: brightness(1.06); }

    /* ---------- Top Bar ---------- */
    .topbar{
      display:none;
      position:sticky; top:0; z-index:10;
      padding:12px 18px;
      color:#fff;
      background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid #ffffff26;
    }
    .topbar__inner{
      max-width:1600px; margin:0 auto;
      display:grid; grid-template-columns: 1fr auto 1fr; align-items:center;
    }
    .brand{
      justify-self:center;
      font-weight:900; letter-spacing:.6px; font-size:18px;
      display:flex; align-items:center; gap:10px;
    }
    .clock{ justify-self:end; background:#ffffff1a; border:1px solid #ffffff2f; padding:6px 10px; border-radius:12px; font-size:12px }

    /* ---------- Grid Container ---------- */
    .container{
      display:none;
      height:calc(100% - 58px);
      padding:14px;
      max-width:100%;
      display:grid; gap:14px;
      grid-template-columns: repeat(3, 1fr);
    }

    /* ---------- Card ---------- */
    .card{
      display:flex; flex-direction:column; overflow:hidden;
      background: var(--card);
      border-radius: var(--radius);
      border: 1px solid #e8eef7;
      box-shadow: var(--shadow);
    }

    .card__head{
      position:relative;
      background: linear-gradient(180deg, var(--brand), #0e3f94);
      color:#fff; text-align:center; font-weight:900;
      padding:16px 14px; font-size:20px;
    }
    .card__head::after{
      content:""; position:absolute; inset:auto 0 0 0; height:3px;
      background: linear-gradient(90deg, #a8d4ff, #e8f3ff00);
    }

    .card__body{ position:relative; flex:1; background:#f6f8fd; min-height:360px; }

    iframe{ position:absolute; inset:0; width:100%; height:100%; border:0 }

    .loading{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:#f6f8fd;
    }
    .chip{
      position:absolute; bottom:14px; right:14px;
      background:#ffffffd9; border:1px solid #d7e2f2; padding:6px 10px; border-radius:10px;
      font-size:12px; color:#234; box-shadow: 0 6px 16px rgba(0,0,0,.08);
    }

    @media (max-width: 1200px){
      .container{ grid-template-columns: repeat(2, 1fr); height:auto; min-height:calc(100% - 58px) }
    }
    @media (max-width: 820px){
      .container{ grid-template-columns: 1fr }
      .clock{ justify-self:center }
    }

    /* ---------- Overlay patches ---------- */
    .iframeCover{
      position:absolute;
      z-index:40;
      background: var(--card);
    }
    .iframeCover.topBlock{ top:0; left:0; right:0; height:50px; pointer-events:auto; }
    .iframeCover.bottomBlock{ bottom:0; left:0; right:0; height:20%; pointer-events:auto; }

    /* Fallback link for TV */
    .fallback-link{
      display:inline-block;
      padding:14px 18px;
      border-radius:12px;
      border:1px solid #cfe0f5;
      text-decoration:none;
      background:#fff;
      box-shadow:0 6px 16px rgba(0,0,0,.08);
      font-weight:700;
    }
  </style>
</head>
<body>

  <div id="start-screen" onclick="startApp()">
    کلیک بکە بۆ دەستپێکردنی شاشەی تەواو
  </div>

  <header class="topbar" id="topbar" aria-label="Header">
    <div class="topbar__inner">
      <div></div>
      <div class="brand">KMCA Live Waitlists</div>
      <div id="clock" class="clock" aria-live="polite">--:--</div>
    </div>
  </header>

  <main class="container" id="dashboard" aria-live="polite">
    <section class="card">
      <div class="card__head">ژمێریاری</div>
      <div class="card__body">
        <div class="loading"><span class="chip">چاوەڕێ بکە…</span></div>
        <iframe src="https://waitwhile.com/locations/accountingandadminis/waitlist" title="ژمێریاری"></iframe>
      </div>
    </section>

    <section class="card">
      <div class="card__head">کارگێڕی</div>
      <div class="card__body">
        <div class="loading"><span class="chip">چاوەڕێ بکە…</span></div>
        <iframe src="https://waitwhile.com/locations/kmcasticker/waitlist" title="کارگێڕی"></iframe>
      </div>
    </section>

    <section class="card">
      <div class="card__head">کۆگا</div>
      <div class="card__body">
        <div class="loading"><span class="chip">چاوەڕێ بکە…</span></div>
        <iframe src="https://waitwhile.com/locations/warehouse1485/waitlist" title="کۆگا"></iframe>
      </div>
    </section>
  </main>

  <script>
    function isTV() {
      const ua = navigator.userAgent || "";
      return /(SmartTV|Tizen|Web0S|WebOS|NetCast|Viera|BRAVIA|AFTB|AFTS|AFTT|AFTM|CrKey|AppleTV)/i.test(ua);
    }

    function startApp(){
      const d=document, el=d.documentElement;
      if(!isTV()){
        try{
          const rfs=el.requestFullscreen||el.webkitRequestFullscreen||el.mozRequestFullScreen||el.msRequestFullscreen;
          if(rfs && !d.fullscreenElement) rfs.call(el);
        }catch(e){}
      }

      d.getElementById('start-screen').style.display='none';
      d.getElementById('topbar').style.display='block';
      d.getElementById('dashboard').style.display='grid';

      addOverlays();
      startClock();
      handleIframeLoaders();
    }

    function startClock(){
      const el=document.getElementById('clock');
      const z=n=>String(n).padStart(2,'0');
      const tick=()=>{
        const t=new Date();
        el.textContent=`${z(t.getHours())}:${z(t.getMinutes())}:${z(t.getSeconds())}`;
      };
      tick(); setInterval(tick,1000);
    }

    function replaceWithFallback(card, url, title){
      const body=card.querySelector('.card__body');
      body.innerHTML=`
        <div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;background:#f6f8fd">
          <div style="font-weight:800">${title}</div>
          <a href="${url}" target="_blank" rel="noopener" class="fallback-link">کڕە بۆ پەڕەی تەواو</a>
          <div style="font-size:12px;color:#456">نەخشەی تیڤی iframe ڕەتی دەکات — پەڕەیەکی نوێ بکەرەوە</div>
        </div>`;
    }

    function handleIframeLoaders(){
      const tv=isTV();
      document.querySelectorAll('.card').forEach(card=>{
        const iframe=card.querySelector('iframe');
        const loader=card.querySelector('.loading');
        const title=card.querySelector('.card__head')?.textContent?.trim() || '';
        const url=iframe.getAttribute('src');

        if(tv){
          replaceWithFallback(card,url,title);
          return;
        }

        let loaded=false;
        const onLoaded=()=>{loaded=true;if(loader)loader.style.display='none';};
        iframe.setAttribute('loading','eager');
        iframe.setAttribute('referrerpolicy','no-referrer-when-downgrade');
        iframe.setAttribute('allow','fullscreen; clipboard-read; clipboard-write');
        iframe.addEventListener('load',onLoaded,{once:true});

        setTimeout(()=>{
          if(!loaded){ if(loader)loader.style.display='none'; replaceWithFallback(card,url,title); }
        },10000);

        setTimeout(()=>loader && (loader.style.opacity=.0, loader.style.pointerEvents='none'),9000);
      });
    }

    function addOverlays(){
      if(isTV()) return;
      document.querySelectorAll('.card__body').forEach(body=>{
        ['topBlock','bottomBlock'].forEach(cls=>{
          const oc=document.createElement('div');
          oc.className='iframeCover '+cls;
          oc.setAttribute('aria-hidden','true');
          body.appendChild(oc);
        });
      });
    }
  </script>
</body>
</html>
